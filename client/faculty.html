<!DOCTYPE html>
<html lang="en" class="h-full">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Faculty Management - e-Haazri</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
    />
    <script src="/_sdk/element_sdk.js"></script>
    <style>
      body {
        box-sizing: border-box;
      }

      * {
        box-sizing: border-box;
      }

      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
        overflow-x: hidden;
      }

      #wrapper {
        min-height: 100%;
        width: 100%;
      }

      .teacher-photo {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        object-fit: cover;
      }

      .sidebar {
        width: 280px;
        min-height: 100vh;
        position: sticky;
        top: 0;
        background-color: #ffffff;
        font-size: 20px;
        flex-shrink: 0;
      }

      .main-content-wrapper {
        flex: 1;
        width: 100%;
        overflow-x: auto;
      }

      .txt {
        color: #6b7280;
        font-size: 18px;
      }

      .nav-link {
        padding: 12px 16px;
        border-radius: 8px;
        transition: background-color 0.3s;
      }

      .nav-link:hover {
        background-color: #f3f4f6;
      }

      .table-responsive {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }

      .btn-sm {
        font-size: 12px;
        padding: 4px 8px;
        margin: 2px;
      }

      .action-buttons {
        white-space: nowrap;
      }

      .is-invalid {
        border-color: #dc3545;
      }

      .message-container {
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 9999;
        min-width: 300px;
      }

      /* Mobile responsive styles */
      @media (max-width: 768px) {
        .sidebar {
          width: 100%;
          min-height: auto;
          position: relative;
          font-size: 16px;
        }

        #wrapper {
          flex-direction: column;
        }

        .teacher-photo {
          width: 30px;
          height: 30px;
        }

        .table {
          font-size: 12px;
        }

        .table th,
        .table td {
          padding: 8px 4px;
          white-space: nowrap;
        }

        .btn-sm {
          font-size: 10px;
          padding: 3px 6px;
          margin: 1px;
        }

        h2 {
          font-size: 24px;
        }

        h4 {
          font-size: 18px;
        }
      }

      @media (max-width: 576px) {
        .sidebar {
          font-size: 14px;
          padding: 15px;
        }

        .sidebar h3 {
          font-size: 20px;
        }

        .table {
          font-size: 11px;
        }

        .filter-label {
          font-size: 13px;
        }

        .form-select {
          font-size: 13px;
          padding: 6px;
        }
      }
    </style>
    <style>
      @view-transition {
        navigation: auto;
      }
    </style>
    <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
    <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
  </head>
  <body class="h-full">
    <script>
      const userType = localStorage.getItem("userType");

      if (!userType) {
        window.location.href = "login.html";
      }

      if (userType === "student" || userType === "faculty") {
        window.location.href = "attendance.html";
      }
    </script>
    <div id="messageContainer" class="message-container"></div>
    <div class="d-flex h-full" id="wrapper" style="background-color: #f7fafc">
      <!-- Sidebar -->
      <div class="text-black p-4 sidebar card">
        <h1 class="p-1" style="margin-left: 10px">e-Haazri</h1>
        <p class="txt" style="margin-left: 10px">College Dashboard</p>
        <hr />
        <ul class="nav flex-column">
          <li class="nav-item">
            <a class="nav-link text-black" href="overview.html">
              <i class="bi bi-house-door-fill me-2"></i>Overview
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link text-black" href="student.html">
              <i class="bi bi-people-fill me-2"></i>Students
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link text-black" href="faculty.html">
              <i class="bi bi-person-badge-fill me-2"></i>Faculty
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link text-black" href="attendance.html">
              <i class="bi bi-calendar-check-fill me-2"></i>Attendance
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link text-black" href="login.html">
              <i class="bi bi-box-arrow-right me-2"></i>Logout
            </a>
          </li>
        </ul>
      </div>
      <!-- Main content -->
      <div class="p-3 main-content-wrapper" style="margin-left: 20px">
        <div class="row">
          <div class="col-md-9 col-12 mb-3">
            <h2 style="color: #000000; font-weight: 500; font-size: 30px">
              Teacher Management
            </h2>
            <p class="txt">
              Manage teacher profile and assignment for Jeppiaar Institute of
              Technology | <span id="currentDate"></span>
            </p>
          </div>
          <div class="col-md-3 col-12">
            <button
              style="
                background-color: #0b3d91;
                border-radius: 8px;
                padding: 10px;
                border: none;
                width: 150px;
              "
              class="text-white"
              onclick="startAdd()"
            >
              + New Teacher
            </button>
          </div>
        </div>
        <br /><!-- Total Teacher card -->
        <div class="col-lg-3 col-md-4 col-sm-6 col-12 mb-3">
          <div class="card p-3">
            <div class="row align-items-center">
              <div class="col-8">
                <h5 class="mb-0" style="font-size: 20px">
                  Total Teachers<br /><span
                    id="teacherCount"
                    class="fs-4 fw-bold"
                    >0</span
                  >
                </h5>
              </div>
              <div class="col-4 text-end">
                <i
                  class="bi bi-people-fill"
                  style="color: #0b3d91; font-size: 2.8rem"
                ></i>
              </div>
            </div>
          </div>
        </div>
        <br /><!-- Teacher List Table -->
        <div class="card" style="border-radius: 10px">
          <h4
            class="p-3"
            style="color: #000000; font-size: 22px; font-weight: 600"
          >
            Teacher List
          </h4>
          <div class="container-fluid px-3">
            <div class="row g-3 mb-3">
              <!-- Year Filter -->
              <div class="col-lg-4 col-md-6 col-12">
                <label for="yearFilter" class="filter-label"
                  >Filter by Year</label
                >
                <select
                  class="form-select"
                  id="yearFilter"
                  onchange="applyFilters()"
                >
                  <option value="all">All Years</option>
                  <option value="i">I</option>
                  <option value="ii">II</option>
                  <option value="iii">III</option>
                  <option value="iv">IV</option>
                </select>
              </div>
              <!-- Department Filter -->
              <div class="col-lg-4 col-md-6 col-12">
                <label for="deptFilter" class="filter-label"
                  >Filter by Department</label
                >
                <select
                  class="form-select"
                  id="deptFilter"
                  onchange="applyFilters()"
                >
                  <option value="all">All Departments</option>
                  <option value="csbs">CSBS</option>
                  <option value="ece">ECE</option>
                  <option value="it">IT</option>
                  <option value="cse">CSE</option>
                  <option value="mech">MECH</option>
                  <option value="aids">AIDS</option>
                </select>
              </div>
              <!-- Subject Filter -->
              <div class="col-lg-4 col-md-6 col-12">
                <label for="subjectFilter" class="filter-label"
                  >Filter by Subject</label
                >
                <select
                  class="form-select"
                  id="subjectFilter"
                  onchange="applyFilters()"
                >
                  <option value="all">All Subjects</option>
                  <option value="survey">Surveying</option>
                  <option value="structural">Structural Engineering</option>
                  <option value="geotech">Geotechnical Engineering</option>
                  <option value="power">Power Electronics</option>
                  <option value="machines">Electrical Machines</option>
                  <option value="circuits">Circuit Theory</option>
                  <option value="ds">Data Structures</option>
                  <option value="os">Operating Systems</option>
                  <option value="dbms">DBMS</option>
                  <option value="ai">Artificial Intelligence</option>
                </select>
              </div>
            </div>
          </div>
          <div class="table-responsive px-3 pb-3">
            <table class="table table-bordered">
              <thead>
                <tr>
                  <th style="background-color: #0b3d91" class="text-white">
                    Photo
                  </th>
                  <th style="background-color: #0b3d91" class="text-white">
                    ID
                  </th>
                  <th style="background-color: #0b3d91" class="text-white">
                    Name
                  </th>
                  <th style="background-color: #0b3d91" class="text-white">
                    Year
                  </th>
                  <th style="background-color: #0b3d91" class="text-white">
                    Department
                  </th>
                  <th style="background-color: #0b3d91" class="text-white">
                    Subject
                  </th>
                  <th style="background-color: #0b3d91" class="text-white">
                    Experience
                  </th>
                  <th style="background-color: #0b3d91" class="text-white">
                    Qualification
                  </th>
                  <th style="background-color: #0b3d91" class="text-white">
                    Contact
                  </th>
                  <th style="background-color: #0b3d91" class="text-white">
                    Actions
                  </th>
                </tr>
              </thead>
              <tbody id="teacherTbody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <!-- Add/Edit Modal -->
    <div class="modal fade" id="teacherModal" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <form
            id="teacherForm"
            onsubmit="saveTeacher(event)"
            enctype="multipart/form-data"
          >
            <div class="modal-header">
              <h5 class="modal-title" id="modalTitle">Add Teacher</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
              ></button>
            </div>
            <div class="modal-body">
              <input
                name="image"
                id="fPhoto"
                type="file"
                class="form-control mb-2"
                accept="image/*"
              />
              <input
                name="facultyId"
                id="fId"
                class="form-control mb-1"
                placeholder="Teacher ID*"
                required
              />
              <div
                id="errorId"
                class="text-danger small mb-2"
                style="display: none"
              ></div>
              <input
                name="name"
                id="fName"
                class="form-control mb-1"
                placeholder="Full Name*"
                required
              />
              <div
                id="errorName"
                class="text-danger small mb-2"
                style="display: none"
              ></div>
              <select name="year" id="fYear" class="form-select mb-1" required>
                <option value="">Select Year*</option>
                <option value="I">I</option>
                <option value="II">II</option>
                <option value="III">III</option>
                <option value="IV">IV</option>
              </select>
              <div
                id="errorYear"
                class="text-danger small mb-2"
                style="display: none"
              ></div>
              <select
                name="department"
                id="fDepartment"
                class="form-select mb-1"
                required
              >
                <option value="">Select Department*</option>
                <option value="CSBS">CSBS</option>
                <option value="ECE">ECE</option>
                <option value="IT">IT</option>
                <option value="CSE">CSE</option>
                <option value="MECH">MECH</option>
                <option value="AIDS">AIDS</option>
              </select>
              <div
                id="errorDepartment"
                class="text-danger small mb-2"
                style="display: none"
              ></div>
              <input
                name="subject"
                id="fSubject"
                class="form-control mb-1"
                placeholder="Subject*"
                required
              />
              <div
                id="errorSubject"
                class="text-danger small mb-2"
                style="display: none"
              ></div>
              <input
                name="experience"
                id="fExperience"
                type="number"
                class="form-control mb-1"
                placeholder="Experience*"
                required
              />
              <div
                id="errorExperience"
                class="text-danger small mb-2"
                style="display: none"
              ></div>
              <input
                name="qualification"
                id="fQualification"
                class="form-control mb-1"
                placeholder="Qualification*"
                required
              />
              <div
                id="errorQualification"
                class="text-danger small mb-2"
                style="display: none"
              ></div>
              <input
                name="contact"
                id="fContact"
                type="tel"
                class="form-control mb-1"
                placeholder="Contact Number*"
                maxlength="10"
                required
              />
              <div
                id="errorContact"
                class="text-danger small mb-2"
                style="display: none"
              ></div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Close
              </button>
              <button type="submit" class="btn btn-primary">Save</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <!-- View Modal -->
    <div class="modal fade" id="viewModal" tabindex="-1">
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header bg-primary text-white">
            <h5 class="modal-title">Teacher Details</h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body" id="viewBody">
            <!-- Teacher details will be injected dynamically -->
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Close
            </button>
          </div>
        </div>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      let facultyData = [];
      let editingId = null;

      // Set current date
      function updateDate() {
        const now = new Date();
        const options = {
          weekday: "long",
          day: "numeric",
          month: "long",
          year: "numeric",
        };
        const formattedDate = now.toLocaleDateString("en-GB", options);
        const dateElement = document.getElementById("currentDate");
        if (dateElement) {
          dateElement.textContent = formattedDate;
        }
      }

      updateDate();

      // Show message function
      function showMessage(message, type) {
        const container = document.getElementById("messageContainer");
        const messageDiv = document.createElement("div");
        messageDiv.className = `alert alert-${type} alert-dismissible fade show`;
        messageDiv.innerHTML = `
          ${message}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
        container.appendChild(messageDiv);
        setTimeout(() => messageDiv.remove(), 4000);
      }

      // Validation functions
      function showError(fieldId, message) {
        const errorDiv = document.getElementById("error" + fieldId);
        const inputField = document.getElementById("f" + fieldId);
        if (errorDiv && inputField) {
          errorDiv.textContent = message;
          errorDiv.style.display = "block";
          inputField.classList.add("is-invalid");
        }
      }

      function hideError(fieldId) {
        const errorDiv = document.getElementById("error" + fieldId);
        const inputField = document.getElementById("f" + fieldId);
        if (errorDiv && inputField) {
          errorDiv.style.display = "none";
          inputField.classList.remove("is-invalid");
        }
      }

      function validateId() {
        const id = document.getElementById("fId").value.trim();
        if (!id) {
          showError("Id", "Teacher ID is required");
          return false;
        }
        if (!/^[A-Za-z0-9]{3,15}$/.test(id)) {
          showError(
            "Id",
            "ID must be 3-15 characters with letters and numbers only"
          );
          return false;
        }
        hideError("Id");
        return true;
      }

      function validateName() {
        const name = document.getElementById("fName").value.trim();
        if (!name) {
          showError("Name", "Name is required");
          return false;
        }
        if (!/^[A-Za-z\s]{3,50}$/.test(name)) {
          showError("Name", "Name must be 3-50 characters with letters only");
          return false;
        }
        hideError("Name");
        return true;
      }

      function validateYear() {
        const year = document.getElementById("fYear").value;
        if (!year) {
          showError("Year", "Please select a Year");
          return false;
        }
        hideError("Year");
        return true;
      }

      function validateDepartment() {
        const department = document.getElementById("fDepartment").value;
        if (!department) {
          showError("Department", "Please select a Department");
          return false;
        }
        hideError("Department");
        return true;
      }

      function validateSubject() {
        const subject = document.getElementById("fSubject").value.trim();
        if (!subject) {
          showError("Subject", "Subject is required");
          return false;
        }
        if (!/^[A-Za-z\s]{2,50}$/.test(subject)) {
          showError(
            "Subject",
            "Subject must be 2-50 characters with letters only"
          );
          return false;
        }
        hideError("Subject");
        return true;
      }

      function validateExperience() {
        const experience = document.getElementById("fExperience").value.trim();
        if (!experience) {
          showError("Experience", "Experience is required");
          return false;
        }
        const expNum = parseInt(experience);
        if (isNaN(expNum) || expNum < 0 || expNum > 50) {
          showError("Experience", "Experience must be between 0 and 50 years");
          return false;
        }
        hideError("Experience");
        return true;
      }

      function validateQualification() {
        const qualification = document
          .getElementById("fQualification")
          .value.trim();
        if (!qualification) {
          showError("Qualification", "Qualification is required");
          return false;
        }
        if (!/^[A-Za-z.\s,]{2,100}$/.test(qualification)) {
          showError("Qualification", "Qualification must be 2-100 characters");
          return false;
        }
        hideError("Qualification");
        return true;
      }

      function validateContact() {
        const contact = document.getElementById("fContact").value.trim();
        if (!contact) {
          showError("Contact", "Contact number is required");
          return false;
        }
        if (!/^[6-9][0-9]{9}$/.test(contact)) {
          showError(
            "Contact",
            "Must be a valid 10-digit number starting with 6-9"
          );
          return false;
        }
        hideError("Contact");
        return true;
      }

      // Add real-time validation listeners
      document.getElementById("fId").addEventListener("blur", validateId);
      document.getElementById("fName").addEventListener("blur", validateName);
      document.getElementById("fYear").addEventListener("change", validateYear);
      document
        .getElementById("fDepartment")
        .addEventListener("change", validateDepartment);
      document
        .getElementById("fSubject")
        .addEventListener("blur", validateSubject);
      document
        .getElementById("fExperience")
        .addEventListener("blur", validateExperience);
      document
        .getElementById("fQualification")
        .addEventListener("blur", validateQualification);
      document
        .getElementById("fContact")
        .addEventListener("blur", validateContact);

      // Save teacher function
      async function saveTeacher(e) {
        e.preventDefault();

        // Validate all fields
        const isIdValid = validateId();
        const isNameValid = validateName();
        const isYearValid = validateYear();
        const isDeptValid = validateDepartment();
        const isSubjectValid = validateSubject();
        const isExpValid = validateExperience();
        const isQualValid = validateQualification();
        const isContactValid = validateContact();

        if (
          !isIdValid ||
          !isNameValid ||
          !isYearValid ||
          !isDeptValid ||
          !isSubjectValid ||
          !isExpValid ||
          !isQualValid ||
          !isContactValid
        ) {
          return;
        }

        const formData = new FormData(document.getElementById("teacherForm"));

        try {
          const url = editingId
            ? `http://localhost:5000/api/faculty/${editingId}`
            : `http://localhost:5000/api/faculty/add`;

          const method = editingId ? "PUT" : "POST";

          const response = await fetch(url, { method, body: formData });
          const result = await response.json();

          if (response.ok) {
            showMessage(
              editingId
                ? "Faculty updated successfully!"
                : "Faculty added successfully!",
              "success"
            );
            loadFacultyList();
            document.getElementById("teacherForm").reset();
            editingId = null;

            // Clear all error messages
            [
              "Id",
              "Name",
              "Year",
              "Department",
              "Subject",
              "Experience",
              "Qualification",
              "Contact",
            ].forEach((field) => {
              hideError(field);
            });

            const modalElement = document.getElementById("teacherModal");
            const modal = bootstrap.Modal.getInstance(modalElement);
            if (modal) {
              modal.hide();
            }
          } else {
            showMessage("Error: " + result.error, "danger");
          }
        } catch (err) {
          console.error(err);
          showMessage("Something went wrong while saving faculty.", "danger");
        }
      }

      // Start add function
      function startAdd() {
        editingId = null;
        document.getElementById("teacherForm").reset();
        document.getElementById("modalTitle").textContent = "Add Teacher";

        // Clear all error messages
        [
          "Id",
          "Name",
          "Year",
          "Department",
          "Subject",
          "Experience",
          "Qualification",
          "Contact",
        ].forEach((field) => {
          hideError(field);
        });

        new bootstrap.Modal(document.getElementById("teacherModal")).show();
      }

      // Start edit function
      function startEdit(id) {
        fetch(`http://localhost:5000/api/faculty/${id}`)
          .then((res) => {
            if (!res.ok) {
              throw new Error("Failed to load faculty details");
            }
            return res.json();
          })
          .then((data) => {
            editingId = id;

            document.getElementById("fId").value = data.facultyId || "";
            document.getElementById("fName").value = data.name || "";
            document.getElementById("fYear").value = data.year || "";
            document.getElementById("fDepartment").value =
              data.department || "";
            document.getElementById("fSubject").value = data.subject || "";
            document.getElementById("fExperience").value =
              data.experience || "";
            document.getElementById("fQualification").value =
              data.qualification || "";
            document.getElementById("fContact").value = data.contact || "";

            document.getElementById("modalTitle").textContent = "Edit Teacher";

            // Clear all error messages
            [
              "Id",
              "Name",
              "Year",
              "Department",
              "Subject",
              "Experience",
              "Qualification",
              "Contact",
            ].forEach((field) => {
              hideError(field);
            });

            new bootstrap.Modal(document.getElementById("teacherModal")).show();
          })
          .catch((err) => {
            console.error(err);
            showMessage("Error loading faculty details", "danger");
          });
      }

      // Confirm delete function
      async function confirmDelete(id) {
        const confirmed = confirm(
          "Are you sure you want to delete this teacher?"
        );
        if (!confirmed) return;

        try {
          const res = await fetch(`http://localhost:5000/api/faculty/${id}`, {
            method: "DELETE",
          });
          if (!res.ok) {
            showMessage("Failed to delete", "danger");
            return;
          }
          showMessage("Faculty deleted successfully", "success");
          loadFacultyList();
        } catch (err) {
          console.error(err);
          showMessage("Error deleting faculty", "danger");
        }
      }

      // View teacher function
      async function viewTeacher(id) {
        console.log("viewTeacher called with id:", id);

        try {
          const res = await fetch(`http://localhost:5000/api/faculty/${id}`);
          const t = await res.json();
          console.log("Backend response:", t);

          if (!res.ok || !t) {
            showMessage("Unable to load teacher", "danger");
            return;
          }

          document.getElementById("viewBody").innerHTML = `
            <div class="text-center mb-3">
              <img src="${
                t.image
                  ? "http://localhost:5000/uploads/faculty/" + t.image
                  : "https://via.placeholder.com/120"
              }"
                style="width:120px;height:120px;border-radius:50%;object-fit:cover;" alt="Teacher photo">
            </div>
            <table class="table table-bordered">
              <tr><th>ID</th><td>${t.facultyId}</td></tr>
              <tr><th>Name</th><td>${t.name}</td></tr>
              <tr><th>Year</th><td>${t.year}</td></tr>
              <tr><th>Department</th><td>${t.department}</td></tr>
              <tr><th>Subject</th><td>${t.subject}</td></tr>
              <tr><th>Experience</th><td>${t.experience} years</td></tr>
              <tr><th>Qualification</th><td>${t.qualification}</td></tr>
              <tr><th>Contact</th><td>${t.contact}</td></tr>
            </table>
          `;

          new bootstrap.Modal(document.getElementById("viewModal")).show();
        } catch (err) {
          console.error("Error in viewTeacher:", err);
          showMessage("Error loading details", "danger");
        }
      }

      // Apply filters function
      function applyFilters() {
        const yearFilter = document
          .getElementById("yearFilter")
          .value.toLowerCase();
        const deptFilter = document
          .getElementById("deptFilter")
          .value.toLowerCase();
        const subjectFilter = document
          .getElementById("subjectFilter")
          .value.toLowerCase();

        const filtered = facultyData.filter((t) => {
          const yearMatch =
            yearFilter === "all" || (t.year || "").toLowerCase() === yearFilter;
          const deptMatch =
            deptFilter === "all" ||
            (t.department || "").toLowerCase() === deptFilter;
          const subjMatch =
            subjectFilter === "all" ||
            (t.subject || "").toLowerCase().includes(subjectFilter);
          return yearMatch && deptMatch && subjMatch;
        });

        renderFacultyTable(filtered);
      }

      // Render faculty table
      function renderFacultyTable(data) {
        const tbody = document.getElementById("teacherTbody");
        tbody.innerHTML = "";

        if (data.length === 0) {
          tbody.innerHTML = `
            <tr>
              <td colspan="10" class="text-center py-4">
                <i class="bi bi-inbox" style="font-size: 3rem; color: #9ca3af;"></i>
                <p class="mt-2 text-muted">No teachers found</p>
              </td>
            </tr>
          `;
          document.getElementById("teacherCount").textContent = 0;
          return;
        }

        document.getElementById("teacherCount").textContent = data.length;

        data.forEach((t) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td><img src="${
              t.image
                ? "http://localhost:5000/uploads/faculty/" + t.image
                : "https://via.placeholder.com/120"
            }"
              class="teacher-photo" alt="Teacher photo"></td>
            <td>${t.facultyId}</td>
            <td>${t.name}</td>
            <td>${t.year}</td>
            <td>${t.department}</td>
            <td>${t.subject}</td>
            <td>${t.experience} years</td>
            <td>${t.qualification}</td>
            <td>${t.contact}</td>
            <td class="action-buttons">
              <button class="btn btn-info btn-sm" onclick="viewTeacher('${
                t._id
              }')">View</button>
              <button class="btn btn-warning btn-sm" onclick="startEdit('${
                t._id
              }')">Edit</button>
              <button class="btn btn-danger btn-sm" onclick="confirmDelete('${
                t._id
              }')">Delete</button>
            </td>
          `;
          tbody.appendChild(tr);
        });
      }

      // Load faculty list
      async function loadFacultyList() {
        try {
          const res = await fetch("http://localhost:5000/api/faculty");
          facultyData = await res.json();
          renderFacultyTable(facultyData);
          console.log("Faculty loaded:", facultyData);
        } catch (err) {
          console.error(err);
          showMessage("Error loading faculty list", "danger");
        }
      }

      // Initialize on page load
      loadFacultyList();

      // Initialize Element SDK
      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig: {},
          onConfigChange: async (config) => {},
          mapToCapabilities: (config) => ({
            recolorables: [],
            borderables: [],
            fontEditable: undefined,
            fontSizeable: undefined,
          }),
          mapToEditPanelValues: (config) => new Map(),
        });
      }
    </script>
    <script>
      (function () {
        function c() {
          var b = a.contentDocument || a.contentWindow.document;
          if (b) {
            var d = b.createElement("script");
            d.innerHTML =
              "window.__CF$cv$params={r:'9b470ffe97153989',t:'MTc2NjgyMDEwMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";
            b.getElementsByTagName("head")[0].appendChild(d);
          }
        }
        if (document.body) {
          var a = document.createElement("iframe");
          a.height = 1;
          a.width = 1;
          a.style.position = "absolute";
          a.style.top = 0;
          a.style.left = 0;
          a.style.border = "none";
          a.style.visibility = "hidden";
          document.body.appendChild(a);
          if ("loading" !== document.readyState) c();
          else if (window.addEventListener)
            document.addEventListener("DOMContentLoaded", c);
          else {
            var e = document.onreadystatechange || function () {};
            document.onreadystatechange = function (b) {
              e(b);
              "loading" !== document.readyState &&
                ((document.onreadystatechange = e), c());
            };
          }
        }
      })();
    </script>
  </body>
</html>
